webpackJsonp([6],{"8qP3":function(o,e){},GPa9:function(o,e){},vr3R:function(o,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=t("mvHQ"),s=t.n(a),r=t("gyMJ"),l=t("PJh5"),i=t.n(l),n={data:function(){return{dialogTitle:"添加书籍",isUpdateAddBookInfo:!0,searchText:"",bookTypeId:"",total:0,pageNum:1,pageSize:12,bookTypeList:[],bookList:[],openBookFromDialog:!1,bookFrom:{BookName:"",BookAuthor:"",BookTanslor:"",BookPress:"",BookTypeId:"",BookPrice:"",BookDiscount:"",BookMprice:"",BookPubDate:"",BookDealmount:"",BookStoremount:"",BookSize:"",Bookisbn:"",BookPackstyle:"",BookOutline:"",BookPic:""},bookFromRules:{BookName:[{required:!0,message:"请输入书籍名",trigger:"blur"}],BookAuthor:[{required:!0,message:"请输入书籍作者",trigger:"blur"}],BookPress:[{required:!0,message:"请输入书籍出版社",trigger:"blur"}],BookTypeId:[{required:!0,message:"请选择书籍类别",trigger:"blur"}],BookPrice:[{required:!0,message:"请输入书籍定价",trigger:"blur"},{pattern:/^\d*\.{0,1}\d{0,1}$/,message:"必须为有效数字",trigger:"blur"}],BookMprice:[{required:!0,message:"请输入书籍现价",trigger:"blur"},{pattern:/^\d*\.{0,1}\d{0,1}$/,message:"必须为有效数字",trigger:"blur"}],BookStoremount:[{required:!0,message:"请输入书籍库存量",trigger:"blur"},{type:"number",message:"必须为数字值"}],BookPackstyle:[{required:!0,message:"请输入书籍封装方式",trigger:"blur"}],Bookisbn:[{required:!0,message:"请输入书籍ISBN",trigger:"blur"}],BookOutline:[{required:!0,message:"请输入书籍简介",trigger:"blur"}]}}},created:function(){this.getBookTypesList(),this.getBookList()},methods:{searchUser:function(){this.pageNum=1,this.getBookList()},getBookTypesList:function(){var o=this;r.h().then(function(e){0===e.data.code?(o.$message.success(e.data.message),console.log(e.data),o.bookTypeList=e.data.data.bookTypeList):o.$message.error(e.data.message)}).catch(function(e){console.error(e),o.$message.error("获取用户书籍分类列表失败, 请重试")})},getBookList:function(){var o=this,e=this.$loading({lock:!0,text:"正在获取书籍列表",background:"rgba(0, 0, 0, 0.2)"});r.g({searchText:this.searchText.trim(),bookTypeId:this.bookTypeId,pageNum:this.pageNum,pageSize:this.pageSize}).then(function(t){0===t.data.code?(o.$message.success(t.data.message),e.close(),console.log(t.data.data.bookList),o.bookList=t.data.data.bookList,o.bookList.forEach(function(o,e){"http"!==o.BookPic.substring(0,4)&&(o.BookPic="http://localhost:3000/"+o.BookPic)}),o.total=t.data.data.total):(o.$message.error(t.data.message),e.close())}).catch(function(t){console.error(t),o.$message.error("获取书籍列表失败, 请重试"),e.close()})},changeBookStatus:function(o,e){var t=this,a=this.$loading({lock:!0,text:"正在书籍状态",background:"rgba(0, 0, 0, 0.2)"});r.s({BookStatus:o,BookId:e}).then(function(o){0===o.data.code?(t.$message.success(o.data.message),a.close(),t.getBookList()):(t.$message.error(o.data.message),a.close())}).catch(function(o){console.error(o),t.$message.error("改变书籍状态失败, 请重试"),a.close()})},colseAddBookDiaLogBefor:function(o){var e=this;this.$confirm("是否取消保存书籍信息?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){o(),e.closeRestFrom("bookFrom"),e.$message({type:"success",message:"已取消保存"})}).catch(function(){})},closeRestFrom:function(o){this.openBookFromDialog=!1,this.$refs[o].resetFields(),this.bookFrom={BookName:"",BookAuthor:"",BookTanslor:"",BookPress:"",BookTypeId:"",BookPrice:"",BookDiscount:"",BookMprice:"",BookPubDate:"",BookDealmount:"",BookStoremount:"",BookSize:"",Bookisbn:"",BookPackstyle:"",BookOutline:"",BookPic:""}},addBookCancel:function(){var o=this;this.$confirm("是否取消保存书籍信息?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){o.closeRestFrom("bookFrom"),o.$message({type:"success",message:"已取消保存"})}).catch(function(){})},saveBookFrom:function(o){var e=this;this.$refs[o].validate(function(t){if(!t)return console.log("error submit!!"),!1;var a=e.$loading({lock:!0,text:"正在保存书籍信息",background:"rgba(0, 0, 0, 0.2)"});e.isUpdateAddBookInfo?r.b(e.bookFrom).then(function(t){0===t.data.code?(e.$message.success(t.data.message),a.close(),e.getBookList(),e.closeRestFrom(o)):(e.$message.error(t.data.message),a.close())}).catch(function(o){console.error(o),e.$message.error("添加书籍信息失败, 请重试"),a.close()}):r.r(e.bookFrom).then(function(t){0===t.data.code?(e.$message.success(t.data.message),a.close(),e.getBookList(),e.closeRestFrom(o)):(e.$message.error(t.data.message),a.close())}).catch(function(o){console.error("错误",o),e.$message.error("编辑书籍信息失败, 请重试"),a.close()})})},openUpdateBookInfo:function(o,e){this.dialogTitle="编辑书籍",this.isUpdateAddBookInfo=!1,this.openBookFromDialog=!0,console.log(e),this.bookFrom=JSON.parse(s()(e))},prevPage:function(){this.pageNum--,this.getBookList()},nextPage:function(){this.pageNum++,this.getBookList()},currentPage:function(o){this.pageNum=o,this.getBookList()},formatterDate:function(o,e){return i()(o.BookPubDate).format("YYYY-MM-DD")},formatterTanslor:function(o,e){if(""===o.BookTanslor)return"无译者";var t=o.BookTanslor;return(t=t.replace(/[\ |\~|\`|\!|\@|\#|\$|\%|\^|\&|\*|\(|\)|\-|\_|\+|\=|\||\\|\[|\]|\{|\}|\;|\:|\"|\'|\,|\，|\<|\.|\>|\/|\?]/g,"")).trim()},formatterType:function(o,e){return this.bookTypeList.find(function(e){return e.value===o.BookTypeId}).label},handleAvatarSuccess:function(o,e){0===o.code?(this.$message.success("上传封面成功"),this.bookFrom.BookPic=o.data.Filepath):this.$message.error("上传封面失败")},uploadActive:function(o,e){console.log(o),console.log(e)},beforeAvatarUpload:function(o){var e="image/jpeg"===o.type||"image/png"===o.type,t=o.size/1024/1024<2;return e||this.$message.error("上传头像图片只能是 JPG 或者 PNG 格式!"),t||this.$message.error("上传头像图片大小不能超过 2MB!"),e&&t},uploadsError:function(o,e,t){this.$message.error("上传头像失败, 请重试")},tableRowClassName:function(o){var e=o.row;o.rowIndex;return"0"===e.BookStatus?"warning-row":""}}},c={render:function(){var o=this,e=o.$createElement,t=o._self._c||e;return t("right-content",[t("content-header",[t("div",{staticClass:"search-box"},[t("el-button",{attrs:{type:"primary"},on:{click:function(e){o.openBookFromDialog=!0}}},[o._v("添加书籍")]),o._v(" "),t("div",{staticClass:"search-box-input"},[t("el-input",{attrs:{placeholder:"输入书籍名进行搜索","prefix-icon":"el-icon-search",clearable:""},on:{change:o.searchUser},model:{value:o.searchText,callback:function(e){o.searchText=e},expression:"searchText"}})],1),o._v(" "),t("div",{staticClass:"search-box-select-input"},[t("el-select",{attrs:{clearable:"",placeholder:"选择分类"},on:{change:o.searchUser},model:{value:o.bookTypeId,callback:function(e){o.bookTypeId=e},expression:"bookTypeId"}},o._l(o.bookTypeList,function(o){return t("el-option",{key:o.value,attrs:{label:o.label,value:o.value}})}),1)],1)],1)]),o._v(" "),t("div",{staticClass:"account-content"},[t("div",{staticClass:"user-table"},[t("el-table",{staticStyle:{width:"100%"},attrs:{border:"",data:o.bookList,height:"100%","header-align":"center","row-class-name":o.tableRowClassName}},[t("el-table-column",{attrs:{type:"expand"},scopedSlots:o._u([{key:"default",fn:function(e){return[t("el-form",{staticClass:"demo-table-expand",attrs:{"label-position":"left",inline:""}},[t("el-form-item",{attrs:{label:"书籍ID"}},[t("span",[o._v(o._s(e.row.BookId))])]),o._v(" "),t("el-form-item",{attrs:{label:"书籍开本"}},[t("span",[o._v(o._s(e.row.BookSize))])]),o._v(" "),t("el-form-item",{attrs:{label:"书籍ISBN"}},[t("span",[o._v(o._s(e.row.Bookisbn))])]),o._v(" "),t("el-form-item",{attrs:{label:"封装方式"}},[t("span",[o._v(o._s(e.row.BookPackstyle))])]),o._v(" "),t("el-form-item",{attrs:{label:"书籍简介"}},[t("span",[o._v(o._s(e.row.BookOutline))])]),o._v(" "),t("el-form-item",{attrs:{label:"书籍封面"}},[t("img",{attrs:{width:"150",height:"150",src:e.row.BookPic,alt:""}})])],1)]}}])}),o._v(" "),t("el-table-column",{attrs:{type:"index",index:1,align:"center",width:40}}),o._v(" "),t("el-table-column",{attrs:{label:"书名",prop:"BookName","show-overflow-tooltip":!0,align:"center",width:150}}),o._v(" "),t("el-table-column",{attrs:{label:"作者",prop:"BookAuthor",align:"center",width:80}}),o._v(" "),t("el-table-column",{attrs:{label:"译者",prop:"BookTanslor",align:"center",formatter:o.formatterTanslor,width:100}}),o._v(" "),t("el-table-column",{attrs:{label:"出版社",prop:"BookPress",align:"center"}}),o._v(" "),t("el-table-column",{attrs:{label:"类别",prop:"BookTypeId",align:"center",formatter:o.formatterType,"min-width":70}}),o._v(" "),t("el-table-column",{attrs:{label:"原价",prop:"BookPrice",align:"center",width:60}}),o._v(" "),t("el-table-column",{attrs:{label:"折扣",prop:"BookDiscount",align:"center",width:50}}),o._v(" "),t("el-table-column",{attrs:{label:"现价",prop:"BookMprice",align:"center",width:60}}),o._v(" "),t("el-table-column",{attrs:{label:"出版日期",prop:"BookPubDate",align:"center",formatter:o.formatterDate}}),o._v(" "),t("el-table-column",{attrs:{label:"销量",prop:"BookDealmount",align:"center",width:80}}),o._v(" "),t("el-table-column",{attrs:{label:"库存",prop:"BookStoremount",align:"center",width:50}}),o._v(" "),t("el-table-column",{attrs:{align:"center",label:"操作"},scopedSlots:o._u([{key:"default",fn:function(e){return[t("el-button",{staticStyle:{"margin-top":"5px"},attrs:{size:"mini",type:"primary"},on:{click:function(t){o.openUpdateBookInfo(e.$index,e.row)}}},[o._v("编辑\n            ")]),o._v(" "),t("el-switch",{attrs:{"active-value":"1","inactive-value":"0","active-color":"#13ce66","inactive-color":"#ff4949",title:"上架或下架书籍"},on:{change:function(t){o.changeBookStatus(e.row.BookStatus,e.row.BookId)}},model:{value:e.row.BookStatus,callback:function(t){o.$set(e.row,"BookStatus",t)},expression:"scope.row.BookStatus"}})]}}])})],1)],1),o._v(" "),t("div",{staticClass:"pagination-box"},[t("el-pagination",{attrs:{background:"",layout:"prev, pager, next",total:o.total,"page-size":o.pageSize,"current-page":o.pageNum},on:{"prev-click":o.prevPage,"next-click":o.nextPage,"current-change":o.currentPage}})],1)]),o._v(" "),t("el-dialog",{attrs:{"custom-class":"my-el-dialog",visible:o.openBookFromDialog,width:"540px",top:"50px","before-close":o.colseAddBookDiaLogBefor},on:{"update:visible":function(e){o.openBookFromDialog=e}}},[t("div",{staticClass:"handle-title text-16-M"},[o._v("\n      "+o._s(o.dialogTitle)+"\n    ")]),o._v(" "),t("div",{staticClass:"dialog-content"},[t("el-form",{ref:"bookFrom",attrs:{model:o.bookFrom,rules:o.bookFromRules,"label-position":"left","label-width":"100px","hide-required-asterisk":""}},[t("el-row",{staticClass:"row-bg",attrs:{type:"flex",gutter:0,justify:"space-between"}},[t("el-col",{attrs:{span:12}},[t("div",{staticClass:"from-item"},[t("el-form-item",{attrs:{label:"书名",prop:"BookName"}},[t("div",{staticClass:"item-input"},[t("el-input",{attrs:{placeholder:"请输入书名"},model:{value:o.bookFrom.BookName,callback:function(e){o.$set(o.bookFrom,"BookName",e)},expression:"bookFrom.BookName"}})],1)])],1)]),o._v(" "),t("el-col",{attrs:{span:2}}),o._v(" "),t("el-col",{attrs:{span:12}},[t("div",{staticClass:"from-item"},[t("el-form-item",{attrs:{label:"作者",prop:"BookAuthor"}},[t("div",{staticClass:"item-input"},[t("el-input",{attrs:{placeholder:"请输入书及作者"},model:{value:o.bookFrom.BookAuthor,callback:function(e){o.$set(o.bookFrom,"BookAuthor",e)},expression:"bookFrom.BookAuthor"}})],1)])],1)])],1),o._v(" "),t("el-row",{staticClass:"row-bg",attrs:{type:"flex",gutter:0,justify:"space-between"}},[t("el-col",{attrs:{span:12}},[t("div",{staticClass:"from-item"},[t("el-form-item",{attrs:{label:"译者",prop:""}},[t("div",{staticClass:"item-input"},[t("el-input",{attrs:{placeholder:"请输入书籍译者"},model:{value:o.bookFrom.BookTanslor,callback:function(e){o.$set(o.bookFrom,"BookTanslor",e)},expression:"bookFrom.BookTanslor"}})],1)])],1)]),o._v(" "),t("el-col",{attrs:{span:2}}),o._v(" "),t("el-col",{attrs:{span:12}},[t("div",{staticClass:"from-item"},[t("el-form-item",{attrs:{label:"出版社",prop:"BookPress"}},[t("div",{staticClass:"item-input"},[t("el-input",{attrs:{placeholder:"请输入书籍出版社"},model:{value:o.bookFrom.BookPress,callback:function(e){o.$set(o.bookFrom,"BookPress",e)},expression:"bookFrom.BookPress"}})],1)])],1)])],1),o._v(" "),t("el-row",{staticClass:"row-bg",attrs:{type:"flex",gutter:0,justify:"space-between"}},[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"书籍类别",prop:"BookTypeId"}},[t("div",{staticClass:"item-input"},[t("el-select",{attrs:{clearable:"",placeholder:"选择分类"},model:{value:o.bookFrom.BookTypeId,callback:function(e){o.$set(o.bookFrom,"BookTypeId",e)},expression:"bookFrom.BookTypeId"}},o._l(o.bookTypeList,function(o){return t("el-option",{key:o.value,attrs:{label:o.label,value:o.value}})}),1)],1)])],1),o._v(" "),t("el-col",{attrs:{span:2}}),o._v(" "),t("el-col",{attrs:{span:12}},[t("div",{staticClass:"from-item"},[t("el-form-item",{attrs:{label:"书籍定价",prop:"BookPrice"}},[t("div",{staticClass:"item-input"},[t("el-input",{attrs:{placeholder:"请输入书籍定价"},model:{value:o.bookFrom.BookPrice,callback:function(e){o.$set(o.bookFrom,"BookPrice",e)},expression:"bookFrom.BookPrice"}})],1)])],1)])],1),o._v(" "),t("el-row",{staticClass:"row-bg",attrs:{type:"flex",gutter:0,justify:"space-between"}},[t("el-col",{attrs:{span:12}},[t("div",{staticClass:"from-item"},[t("el-form-item",{attrs:{label:"折扣",prop:""}},[t("div",{staticClass:"item-input"},[t("el-input",{attrs:{placeholder:"如有折扣请输入"},model:{value:o.bookFrom.BookDiscount,callback:function(e){o.$set(o.bookFrom,"BookDiscount",e)},expression:"bookFrom.BookDiscount"}})],1)])],1)]),o._v(" "),t("el-col",{attrs:{span:2}}),o._v(" "),t("el-col",{attrs:{span:12}},[t("div",{staticClass:"from-item"},[t("el-form-item",{attrs:{label:"书籍现价",prop:"BookMprice"}},[t("div",{staticClass:"item-input"},[t("el-input",{attrs:{placeholder:"请输入书籍现价"},model:{value:o.bookFrom.BookMprice,callback:function(e){o.$set(o.bookFrom,"BookMprice",e)},expression:"bookFrom.BookMprice"}})],1)])],1)])],1),o._v(" "),t("el-row",{staticClass:"row-bg",attrs:{type:"flex",gutter:0,justify:"space-between"}},[t("el-col",{attrs:{span:12}},[t("div",{staticClass:"from-item"},[t("el-form-item",{attrs:{label:"出版日期",prop:""}},[t("div",{staticClass:"item-input"},[t("el-date-picker",{attrs:{type:"date",placeholder:"选择日期"},model:{value:o.bookFrom.BookPubDate,callback:function(e){o.$set(o.bookFrom,"BookPubDate",e)},expression:"bookFrom.BookPubDate"}})],1)])],1)]),o._v(" "),t("el-col",{attrs:{span:2}})],1),o._v(" "),t("el-row",{staticClass:"row-bg",attrs:{type:"flex",gutter:0,justify:"space-between"}},[t("el-col",{attrs:{span:12}},[t("div",{staticClass:"from-item"},[t("el-form-item",{attrs:{label:"库存",prop:"BookStoremount"}},[t("div",{staticClass:"item-input"},[t("el-input",{attrs:{placeholder:"请输入书籍库存量"},model:{value:o.bookFrom.BookStoremount,callback:function(e){o.$set(o.bookFrom,"BookStoremount",o._n(e))},expression:"bookFrom.BookStoremount"}})],1)])],1)]),o._v(" "),t("el-col",{attrs:{span:2}}),o._v(" "),t("el-col",{attrs:{span:12}},[t("div",{staticClass:"from-item"},[t("el-form-item",{attrs:{label:"开本",prop:""}},[t("div",{staticClass:"item-input"},[t("el-input",{attrs:{placeholder:"请输入书籍开本,不详不输"},model:{value:o.bookFrom.BookSize,callback:function(e){o.$set(o.bookFrom,"BookSize",o._n(e))},expression:"bookFrom.BookSize"}})],1)])],1)])],1),o._v(" "),t("el-row",{staticClass:"row-bg",attrs:{type:"flex",gutter:0,justify:"space-between"}},[t("el-col",{attrs:{span:12}},[t("div",{staticClass:"from-item"},[t("el-form-item",{attrs:{label:"书籍ISBN",prop:"Bookisbn"}},[t("div",{staticClass:"item-input"},[t("el-input",{attrs:{placeholder:"请输入书籍ISBN"},model:{value:o.bookFrom.Bookisbn,callback:function(e){o.$set(o.bookFrom,"Bookisbn",e)},expression:"bookFrom.Bookisbn"}})],1)])],1)]),o._v(" "),t("el-col",{attrs:{span:2}}),o._v(" "),t("el-col",{attrs:{span:12}},[t("div",{staticClass:"from-item"},[t("el-form-item",{attrs:{label:"封装方式",prop:""}},[t("div",{staticClass:"item-input"},[t("el-input",{attrs:{placeholder:"请输入书籍开本,不详不输"},model:{value:o.bookFrom.BookPackstyle,callback:function(e){o.$set(o.bookFrom,"BookPackstyle",e)},expression:"bookFrom.BookPackstyle"}})],1)])],1)])],1),o._v(" "),t("el-row",{staticClass:"row-bg",attrs:{type:"flex",gutter:0,justify:"space-between"}},[t("el-col",{attrs:{span:24}},[t("div",{staticClass:"from-item"},[t("el-form-item",{attrs:{label:"书籍简介",prop:"BookOutline"}},[t("div",{staticClass:"item-input"},[t("el-input",{attrs:{type:"textarea",rows:4,placeholder:"请输入书籍简介"},model:{value:o.bookFrom.BookOutline,callback:function(e){o.$set(o.bookFrom,"BookOutline",e)},expression:"bookFrom.BookOutline"}})],1)])],1)])],1),o._v(" "),t("el-row",{staticClass:"row-bg",attrs:{type:"flex",gutter:0,justify:"space-between"}},[t("el-col",{attrs:{span:24}},[t("div",{staticClass:"from-item"},[t("el-form-item",{attrs:{label:"上传书籍封面"}},[t("div",{staticClass:"item-input img-bg"},[t("el-upload",{ref:"uploadsAvatar",staticClass:"avatar-uploader",attrs:{data:{uploadDir:"bookPic"},action:"http://localhost:3000/api/admin/upload","show-file-list":!1,"on-success":o.handleAvatarSuccess,"on-error":o.uploadsError,"on-change":o.uploadActive,"before-upload":o.beforeAvatarUpload}},[o.bookFrom.BookPic?t("img",{staticClass:"avatar",attrs:{src:o.bookFrom.BookPic}}):t("i",{staticClass:"el-icon-plus avatar-uploader-icon"})])],1)])],1)])],1)],1)],1),o._v(" "),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:o.addBookCancel}},[o._v("取 消")]),o._v(" "),t("el-button",{attrs:{type:"primary"},on:{click:function(e){o.saveBookFrom("bookFrom")}}},[o._v("确 定")])],1)])],1)},staticRenderFns:[]};var u=t("VU/8")(n,c,!1,function(o){t("GPa9"),t("8qP3")},"data-v-49e9151e",null);e.default=u.exports}});
//# sourceMappingURL=6.d47fcdec89a5a40cca4d.js.map